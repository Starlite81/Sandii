<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<title>‚ù§Ô∏èSandiiü•π</title>

<style>
/* CSS same as your last working version */
:root{ --gold:#D4AF37; --gold-dark:#a78123; --bg:#FFF9ED; --accent:#2b6cb0; }
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif}
html,body{height:100%;}
body{display:flex;flex-direction:column;background:linear-gradient(180deg,#fffaf0,var(--bg));color:#111}
header{padding:12px 16px;background:linear-gradient(90deg,var(--gold),var(--gold-dark));color:#111;font-weight:700;position:relative;box-shadow:0 2px 10px rgba(0,0,0,0.08)}
.sub{font-weight:600;font-size:16px}
#logout{position:absolute;right:12px;top:10px;font-size:13px;color:#111;background:rgba(255,255,255,0.6);padding:6px 8px;border-radius:8px;cursor:pointer}
#status{font-size:13px;color:#111;opacity:0.95;margin-top:6px}
.container{display:flex;flex:1;gap:12px;padding:12px}
.sidebar{width:260px;background:rgba(255,255,255,0.6);border-radius:14px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);display:flex;flex-direction:column;gap:10px}
#usersList{overflow:auto;flex:1}
.userRow{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;cursor:pointer}
.userRow:hover{background:rgba(0,0,0,0.03)}
.avatar{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff}
.userMeta{font-size:13px}
.userName{font-weight:700}
.userStatus{font-size:12px;color:#666}
.main{flex:1;display:flex;flex-direction:column}
#chatBox{flex:1;overflow-y:auto;padding:18px;display:flex;flex-direction:column;gap:12px;border-radius:12px;background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="100%" height="100%" fill="%23fff7ea"/></svg>');}
.bubble{padding:12px 14px;max-width:72%;border-radius:18px;box-shadow:0 6px 14px rgba(0,0,0,0.06);word-break:break-word;animation:pop .12s ease}
.mine{margin-left:auto;background:linear-gradient(180deg,#fff7e6,#fff5df);border-bottom-right-radius:6px;text-align:right}
.other{margin-right:auto;background:#ffffff;border-bottom-left-radius:6px;text-align:left}
.msgHeader{display:flex;gap:8px;align-items:center}
.msgText{margin-top:6px;font-size:15px}
.msgMeta{display:flex;gap:8px;align-items:center;justify-content:flex-end;font-size:12px;color:#666;margin-top:8px}
.small{font-size:12px;color:#777}
#bar{display:flex;padding:12px;gap:8px;background:transparent;align-items:center}
#msgInput{flex:1;padding:12px 14px;border-radius:18px;border:1px solid rgba(0,0,0,0.09);outline:none;font-size:15px;background:rgba(255,255,255,0.9)}
#sendBtn{background:linear-gradient(90deg,var(--gold),var(--gold-dark));border:none;padding:10px 16px;border-radius:18px;font-weight:700;cursor:pointer;color:#111}
.fileBtn{background:transparent;border:1px dashed rgba(0,0,0,0.06);padding:8px;border-radius:10px;cursor:pointer}
.typing{font-size:13px;color:#444;padding:6px 12px}
@keyframes pop{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
.footerNote{font-size:12px;color:#666;text-align:center;padding:6px}
@media(max-width:860px){.container{padding:8px}.sidebar{display:none}.bubble{max-width:86%}}
</style>
</head>
<body>

<header>
  <div class="sub">‚ù§Ô∏èSandiiü•π</div>
  <div id="logout">Logout</div>
  <div id="status">Loading chat‚Ä¶</div>
</header>

<div class="container">
  <aside class="sidebar">
    <div style="font-weight:800">Contacts</div>
    <div id="usersList"></div>
    <div class="footerNote">Online indicator, avatars, seen ticks, typing & image uploads enabled</div>
  </aside>

  <main class="main">
    <div id="chatBox" aria-live="polite"></div>
    <div class="typing" id="typingIndicator" style="display:none">Someone is typing‚Ä¶</div>
    <div id="bar">
      <input id="fileInput" type="file" accept="image/*" style="display:none" />
      <button id="attachBtn" class="fileBtn" title="Attach image">üìé</button>
      <input id="msgInput" type="text" placeholder="Type your message..." autocomplete="off" />
      <button id="sendBtn">Send</button>
    </div>
  </main>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, query, limitToLast, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

const FIREBASE_CONFIG = { apiKey: "AIzaSyAWcThQ9FoieRoG9DJbzSaRwOqfmg65ykk", authDomain: "chatty-fbb90.firebaseapp.com", databaseURL: "https://chatty-fbb90-default-rtdb.firebaseio.com", projectId: "chatty-fbb90", storageBucket: "chatty-fbb90.firebasestorage.app", messagingSenderId: "44728958212", appId: "1:44728958212:web:9c7068e885943896d3e451", measurementId: "G-NKY98EHV69" };

const app = initializeApp(FIREBASE_CONFIG);
const db = getDatabase(app);
const auth = getAuth(app);
const messagesRef = ref(db, 'messages');
const usersRef = ref(db, 'users');
const statusRefRoot = ref(db, 'status');

const chatBox = document.getElementById('chatBox');
const msgInput = document.getElementById('msgInput');
const sendBtn  = document.getElementById('sendBtn');
const logoutBtn = document.getElementById('logout');
const statusEl = document.getElementById('status');
const typingIndicator = document.getElementById('typingIndicator');
const attachBtn = document.getElementById('attachBtn');
const fileInput = document.getElementById('fileInput');
const usersList = document.getElementById('usersList');

// NAME MAPPING
const NAME_MAP = { 'cosmas@gmail.com':'COSMAS‚ù§Ô∏è', 'sandii@gmail.com':'SANDRA‚ù§Ô∏è' };
function resolveName(msg){ const email = msg.email||''; return NAME_MAP[email] || msg.name || email || 'User'; }

// all other logic remains as your last working version, using resolveName(msg) for names
</script>

</body>
</html>
