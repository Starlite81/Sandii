<!-- FULL UPDATED FILE WITH NAME MAPPING -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>‚ù§Ô∏èSandiiü•π</title>
<style>
  body{margin:0;font-family:Inter,sans-serif;background:#faf7ef;} 
  header{display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#fff;border-bottom:1px solid #e5e5e5;position:sticky;top:0;z-index:50;}
  .sub{font-size:20px;font-weight:700;color:#b8860b;}
  #logout{cursor:pointer;color:#b00;font-weight:600;}
  #chatContainer{display:flex;height:calc(100vh - 60px);} 
  #contacts{width:250px;border-right:1px solid #ddd;padding:10px;background:#fff;overflow-y:auto;} 
  #messages{flex:1;display:flex;flex-direction:column;} 
  #messageList{flex:1;padding:14px;overflow-y:auto;} 
  #inputBar{display:flex;padding:10px;border-top:1px solid #ddd;background:#fff;} 
  #input{flex:1;padding:10px;border:1px solid #ccc;border-radius:10px;font-size:15px;} 
  #send{margin-left:10px;padding:10px 18px;background:#daa520;border:none;border-radius:10px;color:#fff;font-weight:700;cursor:pointer;} 
  .msg{margin-bottom:12px;padding:10px;background:#fff;border-radius:10px;max-width:70%;box-shadow:0 2px 6px rgba(0,0,0,0.08);} 
  .me{background:#ffe8a3;margin-left:auto;} 
  .name{font-weight:700;margin-bottom:3px;color:#444;} 
</style>
</head>
<body>

<header>
  <div class="sub">‚ù§Ô∏èSandiiü•π</div>
  <div id="logout">Logout</div>
</header>

<div id="chatContainer">
  <div id="contacts"></div>
  <div id="messages">
    <div id="messageList"></div>
    <div id="inputBar">
      <input id="input" placeholder="Type a message..." />
      <button id="send">Send</button>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
  import { getDatabase, ref, push, onValue, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAWcThQ9FoieRoG9DJbzSaRwOqfmg65ykk",
    authDomain: "chatty-fbb90.firebaseapp.com",
    databaseURL: "https://chatty-fbb90-default-rtdb.firebaseio.com",
    projectId: "chatty-fbb90",
    storageBucket: "chatty-fbb90.firebasestorage.app",
    messagingSenderId: "44728958212",
    appId: "1:44728958212:web:9c7068e885943896d3e451"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  // NAME REPLACEMENT MAP
  const nameMap = {
    "cosmas@gmail.com": "COSMAS‚ù§Ô∏è",
    "sandii@gmail.com": "SANDRA‚ù§Ô∏è"
  };

  function mapName(email){ return nameMap[email] || email; }

  onAuthStateChanged(auth, user => {
    if(!user){ window.location.href = "index.html"; return; }

    const messageList = document.getElementById("messageList");
    const sendBtn = document.getElementById("send");
    const input = document.getElementById("input");

    const messagesRef = ref(db, "gc_messages");

    onValue(messagesRef, snap => {
      messageList.innerHTML = "";

      snap.forEach(m => {
        const data = m.val();
        const div = document.createElement("div");

        const senderName = mapName(data.email);

        div.className = "msg" + (data.email === user.email ? " me" : "");
        div.innerHTML = `
          <div class='name'>${senderName}</div>
          <div>${data.text}</div>
        `;

        messageList.appendChild(div);
      });

      messageList.scrollTop = messageList.scrollHeight;
    });

    sendBtn.onclick = () => {
      if(!input.value.trim()) return;

      push(messagesRef, {
        email: user.email,
        text: input.value,
        time: serverTimestamp()
      });

      input.value = "";
    };

    document.getElementById("logout").onclick = () => signOut(auth);
  });
</script>

</body>
</html>

